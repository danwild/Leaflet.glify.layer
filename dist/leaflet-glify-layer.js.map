{"version":3,"file":"leaflet-glify-layer.js","sources":["../src/js/L.Glify.Layer.js"],"sourcesContent":["import glify from 'leaflet.glify';\nimport sortWorker from 'web-worker:./sortWorker';\n\nconst GlifyLayer = L.Layer.extend({\n\n\t/*------------------------------------ LEAFLET SPECIFIC ------------------------------------------*/\n\n\t_map: null,\n\n\t// the DOM leaflet-pane that contains our layer\n\t_pane: null,\n\t_paneName: 'overlayPane',\n\n\t_shapesLayer: null,\n\t_linesLayer: null,\n\t_pointssLayer: null,\n\n\t// user options\n\toptions: {\n\t\ttypes: null,\n\t\tgeojson: null\n\t},\n\n\tinitialize: function (options) {\n\t\tL.setOptions(this, options);\n\t},\n\n\t/**\n\t * @param map {Object} Leaflet map\n\t */\n\tonAdd: function (map) {\n\t\t\n\t\tthis._map = map;\n\t\tthis.options.glifyOptions.map = this._map;\n\t\tthis._setPane();\n\t\tthis.options.glifyOptions.pane = this._paneName;\n\n\t\tthis._shapes = [];\n\t\tthis._lines = [];\n\t\tthis._points = [];\n\n\t\tthis._glifyOptions = {\n\t\t\tborder: true,\n\t\t\topacity: 0.2,\n\t\t\tsize: 10,\n\t\t\tcolor: { r: 0.2, g: 0.5333333333333333, b: 1, a: 0 }\n\t\t};\n\n\t\t// merge user options with defaults\n\t\tthis._glifyOptions = Object.assign(this._glifyOptions, this.options.glifyOptions);\n\t\t\n\t\tif(!this.options.types && this.options.geojson) {\n\t\t\t\n\t\t\tthis._separateTypes();\n\t\t\n\t\t} else if(this.options.types) {\n\t\t\n\t\t\tthis._shapes = this.options.types.shapes ?  this.options.types.shapes : {};\n\t\t\tthis._lines = this.options.types.lines ?  this.options.types.lines : {};\n\t\t\tthis._points = this.options.types.points ? this.options.types.points.features.map(f => f.geometry.coordinates) : [];\t\n\t\t\t\n\t\t\tthis._createLayers();\n\t\t\n\t\t} else {\n\t\t\tconsole.error('No geojson or separate types provided.');\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\t// callback\n\t\tif (this.options.onAdd) this.options.onAdd();\n\t},\n\n\t/**\n\t * Remove the pane from DOM, and void pane when layer removed from map\n\t */\n\tonRemove() {\n\t\tthis.remove();\n\t\tif (this.options.onRemove) this.options.onRemove();\n\t},\n\n\t/*------------------------------------ PUBLIC ------------------------------------------*/\n\n\t/**\n\t * Returns [L.latLngBounds](https://leafletjs.com/reference-1.7.1.html#latlngbounds)\n\t * for the L.glify.layer\n\t */\n\tgetBounds() {\n\t\tlet flatCoords = [];\n\t\tif (this._shapesLayer) {\t\t\n\t\t\tflatCoords = flatCoords.concat(this._shapes.features.map(f => f.geometry.coordinates[0]).flat());\n\t\t}\n\t\tif (this._linesLayer) {\n\t\t\tflatCoords = flatCoords.concat(this._lines.features.map(f => f.geometry.coordinates).flat());\n\t\t}\n\t\tif (this._pointsLayer) {\n\t\t\tflatCoords = flatCoords.concat(this._points);\n\t\t}\n\n\t\tconst initialBounds = L.latLngBounds(flatCoords.map(c => [c[1], c[0]] ));\n\t\tconst nw = initialBounds.getNorthWest();\n\t\tconst se = initialBounds.getSouthEast();\n\t\treturn L.latLngBounds(nw, se);\n\t},\n\n\t/**\n\t * Exec update() on each glify layer\n\t * @param {object} data \n\t * @param {number} index \n\t */\n\tupdate(data, index) {\n\t\tif (this._shapesLayer) this._shapesLayer.update(data, index);\n\t\tif (this._linesLayer) this._linesLayer.update(data, index);\n\t\tif (this._pointsLayer) this._pointsLayer.update(data, index);\n\t},\n\n\t/** \n\t * Exec remove() on each glify layer\n\t*/\n\tremove(index) {\n\t\tif (this._shapesLayer) this._shapesLayer.remove(index);\n\t\tif (this._linesLayer) this._linesLayer.remove(index);\n\t\tif (this._pointsLayer) this._pointsLayer.remove(index);\n\t},\n\n\t/**\n\t * Re-render layers\n\t */\n\trender() {\n\t  if (this._shapesLayer) this._shapesLayer.render();\n\t\tif (this._linesLayer) this._linesLayer.render();\n\t\tif (this._pointsLayer) this._pointsLayer.render();\n\t},\n\n\t/**\n\t * Update layer style options\n\t * @param {object} options\n\t * @param {boolean} options.border\n\t * @param {function|object|string} options.color\n\t * @param {number} options.opacity\n\t * @param {number} options.size\n\t */\n\tsetStyle(options) {\n\t\tif (this._shapesLayer) {\n\t\t\tthis._shapesLayer.settings = Object.assign(this._shapesLayer.settings, options);\n\t\t\tthis._shapesLayer.render();\n\t\t}\n\t\tif (this._linesLayer) {\n\t\t\tthis._linesLayer.settings = Object.assign(this._linesLayer.settings, options);\n\t\t\tthis._linesLayer.render();\n\t\t}\n\t\tif (this._pointsLayer) {\n\t\t\tthis._pointsLayer.settings = Object.assign(this._pointsLayer.settings, options);\n\t\t\tthis._pointsLayer.render();\n\t\t}\n\t},\n\n\t/*------------------------------------ PRIVATE ------------------------------------------*/\n\n\t_createLayers(){\n\n\t\tif(this._shapes.features) {\n\t\t\t\tthis._glifyOptions.data = this._shapes;\t\n\t\t\t\tthis._shapesLayer = L.glify.shapes(this._glifyOptions);\n\t\t}\n\n\t\t// coords for lines and points is inverted..  :`(\n\t\t// https://github.com/robertleeplummerjr/Leaflet.glify/issues/78\n\t\t// https://github.com/danwild/Leaflet.glify.layer/issues/1\n\t\tthis._glifyOptions.latitudeKey = 1;\n\t\tthis._glifyOptions.longitudeKey = 0;\n\n\t\tif(this._lines.features) {\n\t\t\tthis._glifyOptions.data = this._lines;\t\n\t\t\tthis._linesLayer = L.glify.lines(this._glifyOptions);\n\t\t}\n\n\t\tif(this._points.length > 0) {\n\t\t\tthis._glifyOptions.data = this._points;\n\t\t\tthis._pointsLayer = L.glify.points(this._glifyOptions);\n\t\t}\n\t\tif (this.options.onLayersInit) this.options.onLayersInit();\n\n\t\t// restore inversion..\n\t\tthis._glifyOptions.latitudeKey = 0;\n\t\tthis._glifyOptions.longitudeKey = 1;\n\t},\n\n\t/**\n\t * Kick off worker job/s to compute keyframes from features.\n\t */\n\t_separateTypes() {\n\n\t\tconst numWorkers = this.options.numWorkers || window.navigator.hardwareConcurrency;\n\t\t\n\t\t// split features into chunks for worker\n\t\tconst featureChunks = this._chunkArray(this.options.geojson.features, numWorkers);\n\t\t\n\t\tlet running = 0;\n\t\n\t\tconst workerDone = (e) => {\n\t\t\trunning -= 1;\n\t\t\t\n\t\t\t// features\n\t\t\tthis._shapes = this._shapes.concat(e.data.shapes);\n\t\t\tthis._lines = this._lines.concat(e.data.lines);\n\t\t\t\n\t\t\t// coords array..\n\t\t\tthis._points = this._points.concat(e.data.points);\n\t\t\t\n\t\t\tif(running < 1) {\n\t\t\t\tthis._shapes = { type: \"FeatureCollection\", features: this._shapes };\n\t\t\t\tthis._lines = { type: \"FeatureCollection\", features: this._lines };\n\n\t\t\t\tthis._createLayers();\n\n\t\t\t\tif (this.options.onLayersInit) {\n\t\t\t\t\tthis.options.onLayersInit();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n    for(let i = 0; i < numWorkers; i += 1) {\n      running += 1;\n      const tWorker = new sortWorker();\n      tWorker.onmessage = workerDone;\n      tWorker.postMessage({ features: featureChunks[i] });\n\t\t}\n\t},\n\n\t/**\n\t * Create custom pane if necessary\n\t * @private\n\t */\n\t_setPane() {\n\t\t// determine where to add the layer\n\t\tthis._paneName = this.options.paneName || 'overlayPane';\n\n\t\t// fall back to overlayPane for leaflet < 1\n\t\tlet pane = this._map._panes.overlayPane\n\t\tif (this._map.getPane) {\n\t\t\t// attempt to get pane first to preserve parent (createPane voids this)\n\t\t\tpane = this._map.getPane(this._paneName);\n\t\t\tif (!pane) {\n\t\t\t\tpane = this._map.createPane(this._paneName);\n\t\t\t}\n\t\t}\n\n\t\tthis._pane = pane;\n\t},\n\n\t/**\n\t * Divide an array into n chunks\n\t * @param {array} array \n\t * @param {number} parts \n\t */\n\t_chunkArray(array, parts) {\n\t\tlet result = [];\n\t\tfor (let i = parts; i > 0; i--) {\n\t\t\t\tresult.push(array.splice(0, Math.ceil(array.length / i)));\n\t\t}\n\t\treturn result;\n\t}\n\n});\n\nL.glify.layer = function (options) {\n\treturn new GlifyLayer(options);\n};\n\nexport default L.glify.layer;\n\n\n"],"names":["GlifyLayer","L","Layer","extend","_map","_pane","_paneName","_shapesLayer","_linesLayer","_pointssLayer","options","types","geojson","initialize","setOptions","onAdd","map","glifyOptions","_setPane","pane","_shapes","_lines","_points","_glifyOptions","border","opacity","size","color","r","g","b","a","Object","assign","_separateTypes","shapes","lines","points","features","f","geometry","coordinates","_createLayers","console","error","onRemove","remove","getBounds","flatCoords","concat","flat","_pointsLayer","initialBounds","latLngBounds","c","nw","getNorthWest","se","getSouthEast","update","data","index","render","setStyle","settings","glify","latitudeKey","longitudeKey","length","onLayersInit","numWorkers","window","navigator","hardwareConcurrency","featureChunks","_chunkArray","running","workerDone","e","type","i","tWorker","sortWorker","onmessage","postMessage","paneName","_panes","overlayPane","getPane","createPane","array","parts","result","push","splice","Math","ceil","layer"],"mappings":"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"}